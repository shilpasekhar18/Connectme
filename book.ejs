<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Service Booking</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        background-image: url("back2.jpg");
      }

      .container {
        max-width: 400px;
        margin: 50px auto;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      input[type="text"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 3px;
        box-sizing: border-box;
      }

      input[type="submit"] {
        background-color: #007bff;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 3px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="main">
      <div class="container">
        <h2>Service Booking</h2>
        <div id="booking-form">
          <% if(data.length==0){ %>
          <div class="form-group">
            <label for="name">Your Name:</label>
            <input type="text" id="name" name="name" required />
          </div>
          <div class="form-group">
            <label for="address">Your Address:</label>
            <input type="text" id="address" name="address" required />
          </div>
          <div class="form-group">
            <label for="phone">Your Phone Number:</label>
            <input
              id="phone"
              type="tel"
              name="phone"
              pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
              placeholder="1234567890"
              maxlength="10"
              required
            />
            <p id="phoneError" style="color: red; display: none">
              Please enter a valid phone number (e.g., 1234567890).
            </p>
          </div>
          <div class="form-group">
            <label for="carddetails">Card details:</label>
            <input
              id="cardetails"
              type="tel"
              name="carddetails"
              placeholder="1234-1234"
              required
            />
            <p id="cardError" style="color: red; display: none">
              Please enter a valid cardnumber (e.g., 1234567890).
            </p>
          </div>
          <button id="mybutton">Book</button>
          <% } else { %>
          <h5 id="bookingExistsMessage" style="display: block">
            Booking Exists. Going Back.
          </h5>
          <% } %>
        </div>
      </div>
    </div>
    <script>
      var data = "<%- JSON.stringify(data.length) %>";
      if (data != 0) {
        setTimeout(() => {
          window.location.href = "/option";
        }, 1500);
      }

      function validateForm() {
        var name = document.getElementById("name").value;
        var address = document.getElementById("address").value;
        var phone = document.getElementById("phone").value;

        if (!name || !address || !phone) {
          alert("Please fill in all fields.");
          return false;
        }
        return true;
      }

      document
        .getElementById("mybutton")
        .addEventListener("click", function () {
          if (validateForm()) {
            var name = document.getElementById("name");
            var address = document.getElementById("address");
            var phone = document.getElementById("phone");
            var form = new FormData();

            form.append("name", name.value);
            form.append("address", address.value);
            form.append("phone", phone.value);

            fetch("/book", {
              method: "POST",
              body: form,
            }).then((res) => {
              if (res.ok) {
                window.location.href = "/booksuc";
              }
            });
          }
        });

      document.getElementById("phone").addEventListener("input", function () {
        const phoneInput = this.value.replace(/\D/g, ""); // Remove non-numeric characters
        const formattedPhone = phoneInput.replace(
          /(\d{3})(\d{3})(\d{4})/,
          "$1$2$3"
        );

        if (phoneInput.length === 10) {
          this.value = formattedPhone;
          document.getElementById("phoneError").style.display = "none";
        } else {
          document.getElementById("phoneError").style.display = "block";
        }
      });
    </script>
  </body>
</html>
